{"version":3,"file":"hyperapp-lazy-components.js","sources":["../src/index.js"],"sourcesContent":["/**\n * @name CACHED_VIEWS\n * @description The views that was load before\n */\nconst CACHED_VIEWS = {}\n\n/**\n * @name createLazy\n * @description The container that will create the lazy components\n * @param {Function} app Hyperapp app\n * @param {Element} container The Element that the lazy component\n * will be loaded \n * \n * @example\n * const modules = {\n *  home: {\n *     component: import('./myModule'),\n *     actions: import('./myModule/actions.js'),\n *     state: import('./myModule/state.js')\n *   }\n * }\n * const { actions, state } = createLazy(app, container)(modules, { loading: <Component /> })\n * \n * @returns {Function} A lazy function to set the modules and\n * the loading component\n */\nexport function createLazy(app, container) {\n  return (modules, loading) => {\n    createLazy.modules = modules\n    createLazy.loading = loading\n    createLazy.app = app\n    createLazy.container = container\n    \n    /**\n     * @description Pass these props to your app function\n     * @returns {Object} \n     * \n     * @example\n     * const { actions, state } = createLazy(app, container)(modules, { loading: <Component /> })\n     * \n     * const appState = {\n     *   ...state,\n     *   ...lazyState\n     * }\n     * \n     * const appActions = {\n     *   ...actions,\n     *   ...appActions  \n     * }\n     * \n     * const main = app(appState, appActions, view, document.body)\n     */\n    return {\n      actions: {\n        fetching: (fetching) => () => ({ fetching }),\n        lazy: {\n          fetching: () => () => ({ lazy: { loading: true, props: undefined } }), \n          loaded: (view) => () => ({ lazy: { view, loading: false, props: undefined } })\n        }\n      },\n      state: {\n      fetching: false,\n        lazy: {\n          view: null,\n          loading: true,\n          props: undefined\n        }\n      }\n    }\n  }\n}\n\n/**\n * @name assign\n * @description Object.assign\n */\nconst assign = Object.assign\n\n/**\n * @name getModule\n * @description Get the module \n */\nconst getModule = module => module.default ? module.default : module\n\n/**\n * @name render\n * @description Render the component providing the props or not.\n * If props are provided, it will be available as state.lazyProps\n *\n *  @param {Object} The data to mount the lazy component on\n * the page.\n *  \n */\nconst render = ({ component, state, actions, props }) => {\n  const container = createLazy.container\n  const appstate = assign(state, { lazy: { props, loading: false } })\n  createLazy.app(appstate, actions, component, container)\n  state.fetching && actions.fetching(false)\n}\n\nconst renderComponent = (data) => {\n  const parentState = data.state\n  const parentActions = data.actions\n    const cacheModule = CACHED_VIEWS[data.component]\n    \n    return render({\n      component: cacheModule.component,\n      actions: assign({}, parentActions, cacheModule.actions),\n      state: assign({}, parentState, cacheModule.state),\n      props: data.props\n    })\n}\n\n\n/**\n * @description Fully load the lazy component with their state and actions.\n * \n * @param {Object} props The props to render the lazy component\n */\nconst loadModule = data => {\n  Promise.all([\n    createLazy.modules[data.component].component,\n    createLazy.modules[data.component].actions,\n    createLazy.modules[data.component].state\n  ]).then(module => {\n    const [component, actions, state] = module\n    const lazyComponent = getModule(component)\n    CACHED_VIEWS[data.component] = {\n      component: lazyComponent,\n      state: getModule(state),\n      actions: getModule(actions),\n    }\n    data.state.fetching && data.actions.lazy.loaded(lazyComponent, false)\n  })\n  \n  !data.state.fetching && data.actions.fetching(true)\n  return data.state.fetching && createLazy.app(true, {}, createLazy.loading(true), createLazy.container.children[0])\n}\n\n/**\n * \n * @param {String} component The component name\n * @param {Any} props The lazyProps state \n * \n * @returns {Function}\n */\nexport const Lazy = ({ component, props }) =>\n  (state, actions) => {\n    return CACHED_VIEWS[component] ? renderComponent({ component, state, actions, props }) : loadModule({ component, state, actions, props })\n  }"],"names":["const","CACHED_VIEWS","createLazy","app","container","modules","loading","actions","fetching","lazy","props","undefined","loaded","view","state","assign","Object","getModule","module","default","renderComponent","data","ref","appstate","parentState","cacheModule","component","Promise","all","then","lazyComponent","children"],"mappings":"AAIAA,IAAMC,KAsBC,SAASC,EAAWC,EAAKC,GAC9B,gBAAQC,EAASC,GAyBf,OAxBAJ,EAAWG,QAAUA,EACrBH,EAAWI,QAAUA,EACrBJ,EAAWC,IAAMA,EACjBD,EAAWE,UAAYA,GAsBrBG,SACEC,kBAAWA,qCAAsBA,KACjCC,MACED,6CAAyBC,MAAQH,SAAS,EAAMI,WAAOC,MACvDC,gBAASC,4BAAkBJ,WAAQI,EAAMP,SAAS,EAAOI,WAAOC,QAGpEG,OACAN,UAAU,EACRC,MACEI,KAAM,KACNP,SAAS,EACTI,WAAOC,MAWjBX,IAAMe,EAASC,OAAOD,OAMhBE,WAAYC,UAAUA,EAAOC,QAAUD,EAAOC,QAAUD,GAkBxDE,WAAmBC,GACvBrB,IARcsB,QACRlB,EACAmB,EAMAC,EAAcH,EAAKP,MAEjBW,EAAcxB,EAAaoB,EAAKK,WAEtC,OAZYJ,GAaVI,UAAWD,EAAYC,UACvBnB,QAASQ,KALSM,EAAKd,QAKYkB,EAAYlB,SAC/CO,MAAOC,KAAWS,EAAaC,EAAYX,OAC3CJ,MAAOW,EAAKX,iCAfVN,EAAYF,EAAWE,UACvBmB,EAAWR,aAAgBN,oBAAeH,SAAS,KACzDJ,EAAWC,IAAIoB,EAAUhB,EAASmB,EAAWtB,QAC7CU,EAAMN,UAAYD,EAAQC,UAAS,gDAiDhBc,+CAClBR,EAAOP,UACCN,EAAayB,GAAaN,aAAkBM,QAAWZ,UAAOP,QAASG,KA7B/DW,aA6BuFK,QAAWZ,UAAOP,QAASG,GA5BnIiB,QAAQC,KACN1B,EAAWG,QAAQgB,EAAKK,WAAWA,UACnCxB,EAAWG,QAAQgB,EAAKK,WAAWnB,QACnCL,EAAWG,QAAQgB,EAAKK,WAAWZ,QAClCe,cAAKX,GACN,kBACMY,EAAgBb,QACtBhB,EAAaoB,EAAKK,YAChBA,UAAWI,EACXhB,MAAOG,EAAUH,GACjBP,QAASU,EAAUV,IAErBc,EAAKP,MAAMN,UAAYa,EAAKd,QAAQE,KAAKG,OAAOkB,GAAe,MAGhET,EAAKP,MAAMN,UAAYa,EAAKd,QAAQC,UAAS,GACvCa,EAAKP,MAAMN,UAAYN,EAAWC,KAAI,KAAUD,EAAWI,SAAQ,GAAOJ,EAAWE,UAAU2B,SAAS,SAjB9FV"}